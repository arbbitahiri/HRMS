@using HRMS.Models.Authorization
@model IEnumerable<RoleDetails>

<table id="tbl_Menu" class="table table-striped table-bordered w-100 table-hover">
    <thead>
        <tr>
            <th>#</th>
            <th>@Resource.Name</th>
            <th>@Resource.Policy</th>
            <th style="width: 20% !important;">@Resource.HasAccess</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<script>
    $(document).ready(function() {
        render_Tbl(@Json.Serialize(Model));
    });

    function render_Tbl(data) {
        $('#mdl_load').css("display", "none");
        $("#tbl_Menu").DataTable({
            language: {
                url: `/Culture/DataTable/${culture}.json`
            },
            keys: true,
            destroy: true,
            responsive: true,
            data: data,
            columnDefs: [
                { targets: 3, className: "w-20" },
                { className: "vertikal", targets: "_all" }
            ],
            order: [[0, "asc"]],
            drawCallback: function () {
                $("input[data-bootstrap-switch]").bootstrapSwitch();
            },
            columns:[
                {
                    data: function (data, type, row, meta) {
                        return meta.row + meta.settings._iDisplayStart + 1;
                    }
                },
                {
                    data: function (row, type, set) {
                        var toReturn = row.menuTitle;
                        if (row.subMenuTitle != "") {
                            toReturn += ` => (${row.subMenuTitle})`;
                        }
                        return toReturn;
                    }
                },
                { data: "claimPolicy" },
                {
                    data: function (row, type, set) {
                        var hasAccess = row.hasAccess ? "checked" : "";
                        return '<input data-switch="true" style="cursor: pointer; width: 90px;" type="checkbox" id="ch_hasAccess" ' +
                                'onchange="change_access(this, \'' + row.menuIde + '\',\'' + row.subMenuIde + '\')" ' + hasAccess + ' ' +
                                'data-bootstrap-switch data-off-color="warning" data-on-color="success">';
                    }
                }
            ]
        });
    }

    function change_access(e, mIde, sIde) {
        $.ajax({
            type: "POST",
            url: '@Url.Action("ChangeAccess", "Authorization")',
            data: {
                Role: $("#Role").val(),
                MenuIde: mIde,
                SubMenuIde: sIde,
                Access: $(e).is(":checked"),
                "__RequestVerificationToken": $("[name='__RequestVerificationToken']").val()
            },
            success: function (data) {
                handle_success(data, SubmitPathType.NORELOAD, "");
            },
            error: function (msg) {
                console.log("Error " + msg);
            }
        });
    }
</script>

