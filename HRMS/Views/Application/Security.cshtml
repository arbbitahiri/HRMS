@using HRMS.Models.Application
@model ServerSearch
@inject IDDLRepository repo
@{
    UserModel user = (UserModel)ViewData["User"];
}

<div class="card">
    <div class="card-header">
        <h3 class="card-title">@Resource.SearchParameters</h3>
    </div>
    <div class="card-body">
        <form asp-action="SearchSecurity" asp-controller="Application" id="frm_search_server" method="post" data-ajax="true" data-ajax-method="post" data-ajax-success="success_search">
            @Html.AntiForgeryToken()

            <div class="row">
                <div class="col-3 form-group">
                    <label asp-for="LogTime">@Resource.Time</label>
                    <input asp-for="LogTime" type="text" class="form-control"/>
                </div>
                <div class="col-3 form-group">
                    <label asp-for="LogTime">@Resource.User</label>
                    <select asp-for="LogTime" asp-items="repo.EventLogEntryTypes()" class="form-control select2"></select>
                </div>
                <div class="col-3 form-group">
                    <label asp-for="LogTime" style="visibility: hidden;">@Resource.IsError</label>
                    <input type="submit" class="btn btn-primary" value="@Resource.Search"/>
                </div>
            </div>
        </form>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h4 class="card-title mb-0">@Resource.SearchResult</h4>
    </div>
    <div class="card-body">
        <table id="tbl_server" class="table table-striped table-bordered w-100 table-hover">
            <thead>
                <tr>
                    <th>#</th>
                    <th>@Resource.Type</th>
                    <th>@Resource.MachineName</th>
                    <th>@Resource.Source</th>
                    <th>@Resource.Time</th>
                    <th>@Resource.Username</th>
                    <th>@Resource.Message</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            var form = $('#frm_search_server');
            form.removeData('validator');
            form.removeData('unobtrusiveValidation');
            $.validator.unobtrusive.parse(form);

            $(".select2").select2({
                width: "100%",
                language: {
                    noResults: function () {
                        return '@Html.Raw(Resource.NoResultsFound)';
                    },
                }
            });

            form.submit();
        });

        function success_search(data) {
            $('#tbl_server').DataTable({
                destroy: true,
                language: {
                    url: `/Culture/DataTable/${culture}.json`
                },
                keys: true,
                responsive: true,
                pageLength: 20,
                data: data,
                columnDefs: [
                    { className: "vertikal", targets: '_all' }
                ],
                order: [[ 0, 'asc' ]],
                columns: [
                    {
                        data: function (data, type, row, meta) {
                            return meta.row + meta.settings._iDisplayStart + 1;
                        }
                    },
                    { "data": "eventLogEntryType" },
                    { "data": "machine" },
                    { "data": "source" },
                    { "data": "time" },
                    { "data": "username" },
                    { "data": "message" }
                ]
            });
        }
    </script>
}
