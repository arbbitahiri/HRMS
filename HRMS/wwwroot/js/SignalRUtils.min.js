var userChat = null; const notification_type = { SUCCESS: 1, INFO: 2, WARNING: 3, ERROR: 4 }; try { if (null != (userChat = sessionStorage.ChatUser) && "null" != userChat) { var chatTemp = JSON.parse(userChat); $.each(chatTemp, function (t, e) { 0 == e.gid ? 0 == e.Minimize ? $.get("/General/Chat/_Chat?u=" + e.connid, function (t) { $(".kt_chat_cont").append(t).show() }) : $.get("/General/Chat/_Chat?u=" + e.connid, function (t) { $(".kt_chat_cont").append(t).show(), $('.kt_chat_max_main[data-cid="' + e.connid + '"]').hide(), $('.kt_chat_min_main[data-cid="' + e.connid + '"]').show() }) : $.get("/General/Chat/_ChatGroup?u=" + e.connid, function (t) { $(".kt_chat_cont").append(t).show() }) }) } } catch (t) { } Object.defineProperty(WebSocket, "OPEN", { value: 1 }), connection.on("Notification", function (t) { get_notifications(), display_notification(t.message, t.title, t.icon, t.url, t.target, t.type) }), connection.on("SendNotification", function (t, e, a, i) { var s; $("#notifications_list").empty(), $.each(t, function (t, e) { var a = null == e.icon ? "fas fa-exclamation" : e.icon, i = e.read ? "" : "background-color: #f4f6f9;", s = 1 == e.language ? "Shëno si të lexuar" : "Mark as read", n = 1 == e.language ? "Shëno si të pa lexuar" : "Mark as unread", d = 1 == e.language ? "Largo" : "Delete", o = e.read ? n : s, l = '<div class="dropdown-divider"></div><div class="dropdown-item" style="' + i + '"><div class="d-flex flex-column flex-grow-1 font-weight-bold"><div class="d-flex justify-content-between mb-1"><a href="' + e.url + '" class="float-left text-dark"><i class="' + a + ' mr-2"></i>' + e.title + '</a><div class="float-right"><a style="cursor: pointer;" class="text-dark mr-2" onclick="mark_as_read(' + e.id + ')" data-toggle="tooltip" title="" data-placement="left" data-original-title="' + o + '"><i class="fab fa-readme"></i></a><a style="cursor: pointer;" class="text-dark" onclick="delete_notification(' + e.id + ')" data-toggle="tooltip" title="" data-placement="left" data-original-title="' + d + '"><i class="fas fa-ban"></i></a></div></div><br /><div class="text-muted text-sm mb-1" style="text-overflow: ellipsis;overflow: hidden;white-space: nowrap;">' + e.description + '</div><span class="float-right text-muted text-sm" style="justify-content: end;display: flex;">' + e.daysAgo + "</span></div></div>"; $("#notifications_list").append(l) }), s = 0 == a ? '<div class="dropdown-divider"></div><a style="cursor: pointer;" class="dropdown-item dropdown-footer" onclick="get_notifications(' + e + ')" a><b>' + i + "</b></a>" : "", $("#notifications_list").append(s) }), connection.on("LastFiveNotifications", function (t) { $("#kt_four_recent_noti").empty(), $("#kt_profile_rec_noti").empty(); var e = "bg-light-success"; $.each(t, function (t, a) { a.notiType == notification_type.SUCCESS ? e = "bg-light-success" : a.notiType == notification_type.WARNING ? e = "bg-light-warning" : a.notiType == notification_type.INFO ? e = "bg-light-info" : a.notiType == notification_type.ERROR && (e = "bg-light-danger"); var i = $("<div></div>", { class: "d-flex align-items-center rounded p-5 mb-5 " + e, html: $("<i/>", { class: a.icon + " mr-5" }) }).append($("<div></div>", { class: "d-flex flex-column flex-grow-1 mr-2", html: $("<a></a>", { href: a.url, class: "font-weight-normal text-dark-75 text-hover-primary font-size-lg mb-1", text: a.title }) }).append($("<span></span>", { class: "text-muted font-size-sm", text: a.description }))); $("#kt_four_recent_noti").append(i), $("#kt_profile_rec_noti").append(i) }) }), connection.on("UserLastFiveNotifications", function (t) { $("#kt_user_last_noti").empty(); var e = "bg-light-success"; $.each(t, function (t, a) { a.notiType == notification_type.SUCCESS ? e = "bg-light-success" : a.notiType == notification_type.WARNING ? e = "bg-light-warning" : a.notiType == notification_type.INFO ? e = "bg-light-info" : a.notiType == notification_type.ERROR && (e = "bg-light-danger"); var i = $("<div></div>", { class: "d-flex align-items-center rounded p-5 mb-5 " + e, html: $("<i/>", { class: a.icon + " mr-5" }) }).append($("<div></div>", { class: "d-flex flex-column flex-grow-1 mr-2", html: $("<a></a>", { href: a.url, class: "font-weight-normal text-dark-75 text-hover-primary font-size-lg mb-1", text: a.title }) }).append($("<span></span>", { class: "text-muted font-size-sm", text: a.description }))).append($("<span></span>", { class: "font-weight-bolder text-warning py-1 font-size-lg", text: a.dago })); $("#kt_user_last_noti").append(i) }) }), connection.on("UnreadNotification", function (t) { t > 0 ? $("#notification_count").text(t).show() : $("#notification_count").hide() }), connection.on("NewMessage", function (t, e, a, i, s, n, d, o, l) { $('.kt_chat_status[data-cid="' + e + '"]').find("span").first().removeClass("label-danger").addClass("label-success"), $('.kt_chat_status[data-cid="' + e + '"]').find("span").last().text("Online"), $('.kt_chat_list_status[data-cid="' + e + '"]').removeClass("bg-success bg-warning bg-danger").addClass("bg-success"); var c = $("<div></div>", { class: "d-flex flex-column mb-1 align-items-start", html: $("<div></div>", { class: "d-flex align-items-center", html: $("<div></div>", { class: "symbol symbol-circle symbol-40 mr-3", html: $("<img/>", { alt: "Pic", src: s }) }) }) }); if (1 == o) { var r = "mt-2 rounded text-dark-50 font-weight-bold text-left w-90 wrap-word"; r += l ? " font-size-h1 " : " font-size-lg p-3 bg-light-success font-size-lg", $($(c).find("div").first()).append($("<div></div>", { class: r, text: t })) } else 2 == o ? c.append($("<img/>", { src: "#", dataSrc: "/General/Chat/GetImage?path=" + t, class: "mt-2 rounded rounded-lg asyncLoad max-h-150px max-w-200px" })) : 3 == o && c.append($("<div></div>", { class: "mt-2 rounded p-3 bg-light-success text-dark-50 font-weight-bold font-size-lg text-left w-90 wrap-word", html: $("<a></a>", { text: t, target: "_blank", href: "/General/Chat/GetFile?p=" + t }) })); $('.kt_left_msg_usr[data-cid="' + e + '"]').text(t), $('.kt_curr_message[data-cid="' + e + '"]').find(".messages").append(c), $(c).find(".asyncLoad").attr("src", $(c).find(".asyncLoad").attr("datasrc")), $(".kt_curr_message[data-cid='" + e + "']").scrollTop($(".kt_curr_message[data-cid='" + e + "']").prop("scrollHeight")) }), connection.on("UnReadMessages", function (t) { $("#unread_msg").text(t + " " + resources.responseJSON.unread), t > 0 ? $("#kt_chat_count").text(t).show() : $("#kt_chat_count").hide() }), connection.on("Status", function (t) { 0 == t.status ? ($('.kt_chat_status[data-cid="' + t.id + '"]').find("span").first().removeClass("label-success").addClass("label-danger"), $('.kt_chat_status[data-cid="' + t.id + '"]').find("span").last().text("Appear away"), $('.kt_chat_list_status[data-cid="' + t.id + '"]').removeClass("bg-success bg-warning bg-danger").addClass("bg-danger")) : ($('.kt_chat_status[data-cid="' + t.id + '"]').find("span").first().removeClass("label-danger").addClass("label-success"), $('.kt_chat_status[data-cid="' + t.id + '"]').find("span").last().text("Online"), $('.kt_chat_list_status[data-cid="' + t.id + '"]').removeClass("bg-success bg-warning bg-danger").addClass("bg-success")) }), connection.on("NewGroupMessage", function (t, e, a, i, s, n, d, o, l) { if ($('.kt_chat_status[data-cid="' + CSS.escape(d) + '"]').find("span").first().removeClass("label-danger").addClass("label-success"), $('.kt_chat_status[data-cid="' + CSS.escape(d) + '"]').find("span").last().text("Online"), $('.kt_chat_list_status[data-cid="' + CSS.escape(d) + '"]').removeClass("bg-success bg-warning bg-danger").addClass("bg-success"), e != connectionId) { var c = $("<div></div>", { class: "d-flex flex-column mb-1 align-items-start", html: $("<div></div>", { class: "d-flex align-items-center", html: $("<div></div>", { class: "symbol symbol-circle symbol-40 mr-3", html: $("<img/>", { alt: "Pic", src: s }) }) }) }); if (1 == o) { var r = "mt-2 rounded text-dark-50 font-weight-bold text-left w-90 wrap-word"; r += l ? " font-size-h1 " : " font-size-lg p-3 bg-light-success font-size-lg", $($(c).find("div").first()).append($("<div></div>", { class: r, text: t })) } else 2 == o ? c.append($("<img/>", { src: "#", dataSrc: "/General/Chat/GetImage?path=" + t, class: "mt-2 rounded rounded-lg asyncLoad max-h-150px max-w-200px" })) : 3 == o && c.append($("<div></div>", { class: "mt-2 rounded p-3 bg-light-success text-dark-50 font-weight-bold font-size-lg text-left w-90 wrap-word", html: $("<a></a>", { text: t, target: "_blank", href: "/General/Chat/GetFile?p=" + t }) })); $('.kt_left_msg_usr[data-cid="' + CSS.escape(d) + '"]').text(t), $('.kt_curr_message[data-cid="' + CSS.escape(d) + '"]').find(".messages").append(c), $(c).find(".asyncLoad").attr("src", $(c).find(".asyncLoad").attr("datasrc")), $(".kt_curr_message[data-cid='" + CSS.escape(d) + "']").scrollTop($(".kt_curr_message[data-cid='" + CSS.escape(d) + "']").prop("scrollHeight")) } }), connection.on("SendRecent", function (t) { $("#chat-custom-loader").hide(), $("#topbar_recent_chat").children().slice(1).remove(), $.each(t, function (t, e) { var a = ""; 0 == e.read && (a = "background-color: ghostwhite;"); var i = $("<div></div>", { onClick: null == e.groupId ? 'LoadUserChat("' + e.id + '")' : 'LoadGroupChat("' + e.gide + '")', class: "d-flex justify-content-between mb-6 rounded-lg cursor-pointer", style: a, html: $("<div></div>", { class: "d-flex", html: $("<div></div>", { class: "symbol symbol-60 symbol-light-primary mr-5", html: $("<span></span>", { class: "symbol-label", html: $("<img/>", { src: null != e.groupId ? "../../../Media/youth.png" : null == e.img ? "../../../Media/user.png" : e.img, style: "height: inherit; width: inherit; border-radius:15px" }) }) }) }).append($("<div></div>", { class: "d-flex flex-column font-weight-bold", html: $("<a></a>", { class: "text-dark text-hover-primary mb-1 font-size-lg", href: "#", text: e.name }) }).append($("<span></span>", { class: "text-muted", text: e.message }))) }).append($("<span></span>", { class: "font-weight-bolder text-primary py-1 font-size-md align-self-end min-w-40px", text: e.differenceTime })); $("#topbar_recent_chat").append(i) }) }), connection.on("SendAudit", function (t) { $("#kt-user-audit").empty(); $.each(t, function (t, e) { e.notiType == notification_type.SUCCESS ? "bg-light-success" : e.notiType == notification_type.WARNING ? "bg-light-warning" : e.notiType == notification_type.INFO ? "bg-light-info" : e.notiType == notification_type.ERROR && "bg-light-danger"; var a = $("<div></div>", { class: "d-flex align-items-center flex-wrap mb-5", html: $("<div></div>", { class: "symbol symbol-50 symbol-light", html: $("<span></span>", { class: "symbol-label", html: $("<img/>", { class: "h-50 align-self-center", src: e.img }) }) }) }).append($("<div></div>", { class: "d-flex flex-column flex-grow-1 ml-2", html: $("<a></a>", { href: "#", class: "font-weight-bolder text-dark-75 text-hover-primary font-size-md mb-1", text: e.description }) }).append($("<span></span>", { class: "text-muted font-weight-bold", text: e.dago }))); $("#kt-user-audit").append(a) }) }), connection.on("NewStat", function (t) { var e = $("<div></div>", { class: "notice d-flex bg-light-danger rounded border-dashed border-danger border p-6 mx-8 mb-6", html: $(t.icon) }).append($("<div></div>", { class: "d-flex flex-stack flex-grow-1", html: $("<div></div>", { class: "font-weight-bold", html: $("<h4></h4>", { class: "text-gray-800 font-weight-bolder", text: t.title }).append($("<div></div>", { class: "text-gray-600", html: $("<div></div>", { class: "alert-text font-size-h6", text: t.errorDescription }) })) }) })); $("#kt_msg_tmp").html(e) }), connection.start().then(function () { });